<extend name="Public/base"/>
<block name="main">
<link rel="stylesheet" href="__PUBLIC__/home/news/css/forgetpwd.css"/>
		<!--页尾-->
		<!--主要内容 开始-->
<form action="{:U('User/updatePwd')}" method="post" ="getpwdform">
			<!--registertop 开始-->
				<div class="registertop">
					<a href="" target="_blank"><img src="__PUBLIC__/home/news/images/logo20141016.png"></a>
					<em></em>
					<span>密码找回</span>
					<a href="" class="return">返回上一步&gt;&gt;</a>
				</div>
			<!--registertop 结束-->
			<!--找回密码第一步 开始-->
				<div class="registerfill" id="step1">
					<div class="fullwidth">
						<div class="part5"><img src="__PUBLIC__/home/news/images/procedure1.jpg"></div>
						<ul class="part6">
							<li>请输入您在卡车之家注册时填写的手机号码</li>
							<li><input class="enter3" id="phone"  type="text" name="phone"><span id="telts"><font id="phoneinfo"></font></span></li>
							<li><input class="makesure2" value="下一步"  type="button" id="nextbtn"></li>
						</ul>
						<p class="hint1">如果您的帐号没有和手机号绑定，无法通过手机找回，请拨打电话 010-56156185 咨询解决</p>
					</div>
				</div>

			<!--找回密码第一步 结束-->
			<!--找回密码第二步 开始-->
				<div class="registerfill" id="step2" style="display:none;">
					<div class="fullwidth">
							<div class="part5"><img src="__PUBLIC__/home/news/images/procedure1.jpg"></div>
							<ul class="part6">
								<li>您己经绑定了手机 <em id="bdtel"></em> 可通过手机短信找回密码</li>
								<li>
									<input class="makesure3" value="发送验证码到我的手机"  id="sendMsg" type="button">

									<span id="telts"><font id="sendinfo"></font></span>
								</li>
								<li>
								<input name="messageyz" class="enter4" value="" style="color:#999999" id="message" type="text">
									<span id="telts"><font id="messinfo"></font></span>
								<input class="makesure4" value="下一步"   id="btnnext3" type="button"></li>
								<li><font>如果您在<em id="time_count_dowm">120秒</em>内没有收到验证码，请重新发送</font></li>
							</ul>
							<p class="hint2"><font>请确保您手机在身边，以便及时收取验证码，手机短信是免费的。</font><br><span>如果您的帐号没有和手机号绑定，无法通过手机找回，请拨打电话 010-56156185 咨询解决。</span></p>
					</div>
				</div>




			<!--找回密码第二步 结束-->
			<!--找回密码第三步 开始-->
				<div class="registerfill" id="step3" style="display:none;">

					<div class="fullwidth">

							<div class="part5"><img src="__PUBLIC__/home/news/images/procedure2.jpg"></div>
							<!-- <h2>您的用户名是：<font id="user_name"></font></h2> -->
							<dl>
								<dt style="height: 38px;"><label>新密码：</label>
									<span><input class="enter" id="password"  type="password" name="password"></span>
									<div id="pwdts" style="float:left;">
										<span style="color: #c4c4c4;"><font id="pwdinfo">请填写您的密码！</font></span>
									</div>
								</dt>
								<dd><em class="normal" id="staus_1">弱</em><em class="normal" id="staus_2">中</em><em class="normal" id="staus_3">强</em></dd>
							</dl>
							<dl>
								<dt><label>确认密码：</label>
									<span><input class="enter" id="repassword" type="password"></span>
									<div id="pwdts_sure" style="float:left;">
										<span style="color: #c4c4c4;"><font id="repwdinfo">请再次填写您的密码</font></span>
									</div>
								</dt>
							</dl>
							<dl>
								<dt class="spe1"><input class="makesure4" value="确认"  id="passsub" type="submit"></dt>
							</dl>
						</div>

					</div>



					</form>
			<!--找回密码第三步 结束-->
			<!--找回密码成功显示页面 开始-->

					<div class="registerfill" style="display:none">
					    <div class="fullwidth">
								<div class="part5"><img src="__PUBLIC__/home/news/images/procedure3.jpg"></div>
					            <div class="complete">
					                <p><font>恭喜您，</font><span>设置新密码成功</span></p>
					                <p>系统 <em id="ShowDiv">5</em> 秒后自动跳转至原页面 </p>
					                <p class="autojump">您还可以访问：<a href="{:U('Index/index')}" target="_blank">卡车之家首页</a>  <a href="" target="_blank">论坛</a>  <a href="memcp.php" target="_blank">个人中心</a></p>
					            </div>
					    </div>
					</div>
			<!--找回密码成功显示页面 结束-->



		<!--主要内容 结束-->
	<script>
		$(function(){
			var phonebool=false,messagebool=false,pwdbool=false,repwdbool=false;
			$('#phone').blur(function(){
				var reg=/^(13[0-9]|14[0-9]|15[0-9]|18[0-9])\d{8}$/i;
				var value=$.trim($(this).val());
				if(value==""){
					$("#phoneinfo").addClass("wrong");
					$('#phoneinfo').html("请输入手机号码");
					phonebool=false;

				}else if(!reg.test(value)){
					$("#phoneinfo").addClass("wrong");
					$('#phoneinfo').html("手机不符合规范");
					phonebool=false;
				}else{
					$.post("{:U('User/checkPhone')}",{'phone':value},function(msg){
						console.log(msg);
						if(!msg){
							$("#phoneinfo").addClass("wrong");
							$('#phoneinfo').html("该手机号码没有注册");
							phonebool=false;
						}else{
							phonebool=true;
							$("#phoneinfo").removeClass("wrong").addClass("correct");
							$('#phoneinfo').html("输入正确");



							str1=msg.phone.substr(0,3);
							str2=msg.phone.substr(7,4);
							$('#bdtel').html(str1+"****"+str2);
						}

					});
				}
			});
		$('#nextbtn').click(function(){
			if(phonebool==true){
					$("#step1").css("display","none");
					$("#step2").css("display","block");
			}else{

					$("#step1").css("display","block");
					$("#step2").css("display","none");

			}
		});
		$('#sendMsg').click(function(){

					// 点击按钮发送ajax请求
					var value=$('#phone').attr("value");
					//console.log(value);
					$.post("{:U('User/getPhone')}",'phone='+value,function(msg){
					//console.log(msg);
					if (msg.status != 0) {
						//alert(msg.msg);
						$('#sendinfo').addClass("wrong");
						$('#sendinfo').html("发送失败");
					} else {
						//alert('发送成功');
						$('#sendinfo').removeClass('wrong').addClass("correct");
						$('#sendinfo').html("发送成功，在五分钟之内有效");
					}
				});
			});
		$('#message').blur(function(){
				var value=$(this).val();
				$.post('{:U('User/yzMessage')}','messageyz='+value,function(msg){
					if (msg=="no") {
						$('#messinfo').addClass("wrong");
						$('#messinfo').html("验证码错误");
						messagebool=false;

					} else if(msg=="outtime") {
						//alert(msg.msg);
						$('#messinfo').addClass("wrong");
						$('#messinfo').html("验证码过期");
						messagebool=false;
					}else{
						//alert('发送成功');
						$('#messinfo').removeClass('wrong').addClass("correct");
						$('#messinfo').html("验证码正确");
						messagebool=true;
					}
				})

			});
		$('#btnnext3').click(function(){
			if(messagebool==true){
				$('#step2').css("display","none");
				$('#step3').css("display","block");
			}else{
				$('#step3').css("display","none");
				$('#step2').css("display","block");
			}
		});
		$('#password').keyup(function(){
			var value=$.trim($(this).val());
			var reg1=/\w[0-9]/;
			if(value.length<6){
				$("#pwdinfo").addClass("wrong");
				$('#pwdinfo').html("密码不得少于6位");
				$('#staus_1').addClass("ok");
				pwdbool=false;
			}
			if(reg1.test(value)){
				$("#pwdinfo").removeClass("correct").addClass("wrong");
				$('#pwdinfo').html("密码不能为纯数字");
				$('#staus_1').addClass("ok");
				pwdbool=false;
			}else{
				$('#staus_1').removeClass("ok").addClass("normal");
				pwdbool=false;
			}
			var reg2=/\w[0-9a-zA-Z]{6,}/;
			if(reg2.test(value)){
				$("#pwdinfo").removeClass("wrong").addClass("correct");
				$('#pwdinfo').html("密码强度为中");
				$('#staus_1').removeClass("ok").addClass("normal");
				$('#staus_2').removeClass("normal").addClass("ok");
				pwdbool=true;
			}else{
				$('#staus_2').removeClass("ok").addClass("normal");
			}
			var reg3=/[!@#\$%\^&*~\+=]/;
			if(reg3.test(value)){
				$("#pwdinfo").removeClass("wrong").addClass("correct");
				$('#pwdinfo').html("密码强度为强");
				$('#staus_2').removeClass("ok").addClass("normal");
				$('#staus_3').addClass("ok");
				pwdbool=true;
			}else{
				//$('#staus_2').removeClass("ok").addClass("normal");
				$('#staus_3').removeClass("ok").addClass("normal");
			}
		});
		$('#password').blur(function(){

		});
		$("#repassword").blur(function(){
			var value1=$.trim($('#password').attr("value"));
			var revalue=$.trim($(this).val());
			if(value1!=revalue){
				$("#repwdinfo").addClass("wrong");
				$('#repwdinfo').html("两次输入密码不一致");
				repwdbool=false;
			}else{
				$("#repwdinfo").removeClass("wrong").addClass("correct");
				$('#repwdinfo').html("输入正确");
				repwdbool=true;
			}
		});
		$('#getpwdform').submit(function(){
			if(repwdbool==true && pwdbool==true){
				return true;
			}
			return false;
		})


	})

	</script>

	</block>